<!-- omit in toc -->
# Rime·徐码·CJK全汉字拆分·三重注解·自定义常用字集

forFudan

- 2022年3月31日 初版
- 2023年3月7日 本方案现在提供CJK所有汉字或部首的全字拆分，共计98446个字符，提供基于《古籍印刷通用字规范字形表》的繁体方案。

**欢迎尝试笔者最近开发的[宇浩繁简通用输入法](https://zhuyuhao.com/yuhao)。覆盖CJK全汉字、取一二三末根、不分主副根，字根在键盘上分区排列，更容易学习。**

- [1. 介绍](#1-介绍)
  - [1.1. 徐码·尔雅输入法·2023年新版](#11-徐码尔雅输入法2023年新版)
  - [1.2. 徐码教程](#12-徐码教程)
  - [1.4. 本方案](#14-本方案)
- [2. 使用](#2-使用)
  - [2.1. Windows / Macos / 安卓安装方法](#21-windows--macos--安卓安装方法)
  - [2.2. 具体文件介绍](#22-具体文件介绍)
- [3. 方案特点](#3-方案特点)
  - [3.1. 提示快捷键](#31-提示快捷键)
  - [3.2. 单字拆分三重注解](#32-单字拆分三重注解)
  - [3.3. 单字简码调整](#33-单字简码调整)
  - [3.4. 二级简码矩阵](#34-二级简码矩阵)
  - [3.5. 词语简码调整](#35-词语简码调整)
  - [3.6. 标点符号二简快速输入](#36-标点符号二简快速输入)
  - [3.7. 增广常用字符集](#37-增广常用字符集)
  - [3.8. 一键切换字符集](#38-一键切换字符集)
  - [3.9. 使用 \` 键引导四叶草拼音输入和反查](#39-使用--键引导四叶草拼音输入和反查)
  - [3.10. 全码词语屏蔽](#310-全码词语屏蔽)
- [4. 非官方·手感优化方案·更少的Z](#4-非官方手感优化方案更少的z)
  - [4.1. 动机和算法](#41-动机和算法)
  - [4.2. 重码數據](#42-重码數據)
  - [4.3. 改动](#43-改动)
  - [4.4. 方案名](#44-方案名)
  - [4.5. 手感數據](#45-手感數據)
    - [4.5.1. 简体文本调整版数据](#451-简体文本调整版数据)
    - [4.5.2. 繁体文本调整版数据](#452-繁体文本调整版数据)

## 1. 介绍

### 1.1. 徐码·尔雅输入法·2023年新版

徐码·尔雅输入法是由徐国银先生发明的一种优秀的形码输入法方案，特点为双编码。优点包括：繁简通打、支持CJK大字集、低重码、全码简码一致、字词编码一致等。官方网站：<http://xumax.cn/> 官方QQ群: 761401688

这里对比一下五笔、郑码、徐码、虎码在不同汉字字符集下的单字全码的重码数量，以供参考。这些都是我比较喜欢、有亮点的输入法。仓颉虽然是五码定长，但它在繁体输入上地位很高，所以也将它纳入比较。加粗的数字代表本行最优值。排名按发明时间顺序：

| 形碼方案   |  GB2312 | 國字常用 | 常用繁簡 |      GBK | 簡體選重率 | 繁簡選重率 |
| :--------- | ------: | -------: | -------: | -------: | ---------: | ---------: |
| 倉頡(五代) |     422 |      164 |      606 | **2893** |      0.89% |      0.83% |
| 五筆(86)   |     537 |      357 |     1718 |     6582 |      0.34% |      2.74% |
| 五筆(98)   |     515 |      329 |     1656 |     6368 |      0.38% |      2.77% |
| 鄭碼       |     563 |      311 |     1784 |     6590 |      0.60% |      2.92% |
| 徐碼       |     318 |  **127** |  **480** |     2902 |      0.11% |      0.15% |
| 虎碼       |     532 |      238 |     2049 |     7687 |  **0.06%** |      4.00% |
| [宇浩](https//zhuyuhao.com/yuhao)       | **307** |      218 |      608 |     4982 |  **0.06%** |  **0.14%** |

注：[宇浩繁简通用输入法](https://zhuyuhao.com/yuhao)是我在使用徐码写了一百万字小说后开发的输入法，借鉴了五笔字形的徐码的优点，改进了徐码取回头码的不便之处。它覆盖CJK全汉字、取一二三末根、不分主副根，字根在键盘上分区排列，更容易学习。**

### 1.2. 徐码教程

[點擊此處閱讀我所寫的《徐碼輸入法簡明教程》（繁體版）來瞭解和學習徐碼。](tutorial.md)

[点击此处阅读我所写的《徐码输入法简明教程》（简体版）来了解和学习徐码。](tutorial_simp.md)

### 1.4. 本方案

本方案在2023年1月15日官方码表基础上进行深度定制。挂载于RIME平台（小狼毫、鼠须管）<https://rime.im/>。其具有以下特点：

- 提供至CJK-H区、兼容区、部首区超过98000个汉字的完整拆分、编码提示、字集提示。
- 为简化字和繁体字重新设置一级简码和二级简码。
- 支持二级简码快速标点符号输入。
- 支持自定义字符集过滤生僻字。常用字约一万字，包括GB2312汉字、國語常用字、其它常用汉字等。支持用户自定义修改。
- 提供四码只出单字功能，适合单字派。

## 2. 使用

### 2.1. Windows / Macos / 安卓安装方法

在安装了 Rime（小狼毫、鼠须管、同文）后，将 [/schema](https://github.com/forFudan/xuma/tree/main/schema) 文件夹下的所有文件复制到 Rime 目录下。同时在 default.custom.yaml 文件中加入以下内容：

```yaml
patch:
  schema_list:
    - schema: xuma_forfudan
    - schema: xuma_forfudan_tc
```

点击「部署」之后即可使用。

### 2.2. 具体文件介绍

文件介绍：

- xuma_forfudan.schema.yaml 简体方案文件
- xuma_forfudan.dict.yaml 简体字典文件
- xuma_forfudan.words.dict.yaml 拓展词库
- xuma_forfudan.schema.yaml 繁体方案文件
- xuma_forfudan.dict.yaml 繁体字典文件
- rime.lua 脚本设定
- lua/forfudan_freq_filter.lua 字符集过滤脚本。可添加自定字符。
- opencc/... 單字拆分表
- build/clover... 已编译好的四叶草拼音文件。或者自行安装。<https://github.com/fkxxyz/rime-cloverpinyin>

## 3. 方案特点

### 3.1. 提示快捷键

输入`help`可显示快捷键提示。

### 3.2. 单字拆分三重注解

提供至CJK-H区、兼容区、部首区超过98000个汉字的完整拆分、编码提示、字集提示。拆分提示中包括三重注解：

1. 该汉字的完整拆分（所有部件）。
2. 该汉字的全码。使用大小写字母区分大小码，便于初学者分辨主、副根字。
3. 该汉字所在的字符集（GB2312，GBK，CJK，CJK A 到 H 区，兼容字等）。

用户还可通过「Shift+Ctrl+C」切换拆分状态。

![拆分](/resources/拆分.png)

### 3.3. 单字简码调整

本方案根据简化字体系下的字频数据，调整了一级、二级、三级单字简码。其中，一级简码调整如下（共8个）：

- A「以」改为「能」。否则「能」字需要`asv`三码出字。
- C「发」改为「好」。因为「好」字频更高。且让出了二简位给同样高频的「她」字。
- D「那」改为「对」。否则高频「对」字需要`dico`四码出字。
- H「在」改为「有」。否则高频「有」字需要`hsv`三码出字。
- M「同」改为「见」。否则高频「见」字需要`mve`三码出字。
- N「国」改为「当」。否则高频「当」字需要`nbu`三码出字。
- S「得」改为「然」。
- Z「为」改为「没」。否则「没」字需要三码出字，且`zqs`会在左手小指，非常不便。

二级简码也作部分调整，比如：

- xq 码位由「将」改为「次」，否则需要`xqqs`四码出字。

特别的，部分字频不高的繁体字和传承字字根移到三选。这样可以腾出一个二简码位用于高频字。例如：

- 「艮0.00%」移到三选，同时将码位让给「司0.05%」
- 「巳0.00%」移到三选，同时将码位让给「通0.06%」
- 「殳0.00%」移到三选，同时将码位让给「解0.07%」
- 「冊0.00%」移到三选，同时将码位让给「内0.08%」
- 「韋0.00%」移到三选，同时将码位让给「尽0.04%」
- 「戊0.00%」移到三选，同时将码位让给「太0.10%」
- 「缶0.00%」移到三选，同时将码位让给「年0.18%」
- 「歹0.00%」移到三选，同时将码位让给「五0.06%」
- 「臣0.01%」移到三选，同时将码位让给「打0.15%」
- 「瓜0.01%」移到三选，同时将码位让给「后0.34%」
- 「虫0.01%」移到三选，同时将码位让给「些0.20%」
- 「申0.00%」移到三选，同时将码位让给「明0.15%」
- 「烏0.01%」移到三选，同时将码位让给「今0.07%」
- 「馬0.09%」移到三选，同时将码位让给「现0.22%」
- 「弋0.00%」移到三选，同时将码位让给「式0.03%」
- 「匕0.00%」移到三选，同时将码位让给「条0.05%」
- 「舟0.00%」移到三选，同时将码位让给「种0.14%」
- 「髟0.00%」移到三选，同时将码位让给「妻0.01%」

同时，我们为所有字根增加**替身码**，重复其小码即可实现输入。例如：

- 艮 `bgg`
- 巳 `dss`
- 殳 `qss`

### 3.4. 二级简码矩阵

[点击此处，查看二级简码矩阵。](second_level_matrix.md)

### 3.5. 词语简码调整

本方案根据简化字体系下的词频，调整了一级、二级词语简码。

值得注意的是，在官方码表中，二简二选词语取两个字首码。这导致词语全码简码不一致。在本方案中，统一调整取消这种取码方式。

关于简码词的设置有一些原则：

- 词频越靠前，设置简词的可能性越高。
- 如果简词的第一个字在二简一选位，则优先放在二简。例：「毕竟」，因为「毕」是二简字，所以「毕竟」也设成二简而不是一简。
- 接上，如果简词的频率过高，仍然设在一简。例：「如果」，虽然「如」是二简字，但是「如果」的词频太高，所以放在了一简位上。

一简码位都有二选简词和三选简词。

二简码位不一定有两个简词。如果一个词没有重码，那么将它设在二简位只省了一个按键，还会增加记忆负担，故而二简词只在以下情况下会设置：

1. 一个词的词频非常高，故而提供简码位。
2. 一个词的全码输入时不符合人体工学。

### 3.6. 标点符号二简快速输入

对于一些使用频率不高的二简码位，提供标点符号的快速输入，包括：

- 「」，单方引号，aj
- 『』，双方引号，ak
- “”，双圆引号，ah
- ‘’，单圆引号，ai
- 〔〕，六角引号，al
- ：，冒号，mm
- 《》，书名号，sm
- ！，感叹号，gg
- ？，问号，ww
- ——，破折号，pp
- ……，省略号，sl
- ×，隐讳符，yh
- □，缺字符，qz
- 々，叠字符，dz，也可以通过 qwu 输入。
- ·，间隔符，yy
- §，章节号，zj
- 、，顿号，nn
- ，，逗号，oo
- 。，句号，jj
- 全角空格，dl

### 3.7. 增广常用字符集

本方案使用了自定的常用字符，将常用字一网打尽，避免了 RIME 内置字符集「GB2312字太少，GBK字太多」的问题。包括了以下一万个左右的字符：

- GB2312 全部字符
- 台湾的「国字常用字」
- 注音符号
- 「〇」符号
- 「镕」等 GB2312 未收录的常用简化字
- 「喆裏墻粧嫺綫綉滙峯」等「国语常用字」未收录的常用繁体字
- 「咲雫乭」等常见日韩汉字

### 3.8. 一键切换字符集

在输入过程中，用户可选择两种切换字集的方式：

- 通过「Shift+Ctrl+O」在常用字符集和CJK大字符集之间进行切换（过滤）。
- 通过「Shift+Ctrl+I」将常用字符集优先显示（优先）。

用户还可通过「Shift+Ctrl+F」进行简入繁出输入。

### 3.9. 使用 ` 键引导四叶草拼音输入和反查

按下 ` 键，可以随时使用四叶草拼音输入词语，并实现反查。四叶草拼音：<https://github.com/fkxxyz/rime-cloverpinyin>

![反查](/resources/反查.png)

### 3.10. 全码词语屏蔽

一键屏蔽四码词语，同时保留简码词。热键为「Shift+Ctrl+D」。适合保留简码词的全码单字派。

## 4. 非官方·手感优化方案·更少的Z

### 4.1. 动机和算法

徐码中，不少常用字根分布在 Z 键和 X 键 上，导致此两键的频率畸重，这个情况在打简体时尤甚，对左手的小指造成了很大的负担。因此，我对徐码的方案进行了调整，以达到以下目的:

- 大量减少 Z 键和 X 键的使用频率，解放左手小指。
- 在 GB2312 和 GBK 字集中，降低静态重码和动态重码(字频加权)。
- 改动字根时不过分影响记忆。小码尽量使用拼音中的字母帮助记忆(若无法达到,使用中间一行的`asdfghjkl`九键)。一般的，借用`k`代替`ch`和`k`入聲尾，借用`j`代替`i`，借用`s`代替`z`，借用`ks`代替`x`。
- 尽量让大小码分布在左右手上，增加双手互击。
- 尽量选择中间一排的按键。

本优化利用了程序，其算法为:

- 对每一个字根，确定其小码的候选列表，为其汉语拼音中的字母，加上中间一行字母，减去`z`和`x`，对于高频成字字根，还要减去同手的按键，增加互击。
- 对每一个字根，寻找静态重码最低的小码。
- 在GB2312字集内，不断随机选出字根，重复上述操作。
- 当重码降至不能再降以后，再次在GBK范围内进行遍历，且保证GB2312重码不增。
- 当重码降至不能再降以后，再次在GB2312范围内进行遍历，寻找动态重码率和手感提升的解。

### 4.2. 重码數據

改动后，静态重码率如下：

- GB2312重碼：318 降至 311
- 通規+國字常用：674 降至 663
- GBK重碼：2886 降至 2847

动态重码率（当代汉语简体字字频加权）：

GB2312动态重码率：0.0499%。即只打**全码**，不打簡碼的情况下，每万字选重只有5次。

GB2312中，除卻不變的重碼字：

- 原徐碼獨有的重碼字爲：媾缅缝终需雩柴此踊嗵铒钳怨急饵馑俯仪逾怔记漏涌诵溻谒闾溃讽澹

- 新方案獨有的重碼字爲：骧驴袈迦襞避拆逝裘逑钛链镶镳锎锏镧舔适庹遮注润

### 4.3. 改动

首先，将Z键上的副根全部移走，改动的有7个：

- **「辶」由`Zd`改为`Wk`。解放小拇指。「辶」音`chuo`，借用`k`代替`ch`。**
- 「讠」由`Zy`改为`Wn`。解放小拇指。
- **「之」由`Zz`改为`Wj`。解放小拇指。**
- 「户」由`Zh`改为`Wh`。解放小拇指。
- 「门」由`Zm`改为`We`。解放小拇指。

其次，將小码爲x和z的字根進行調整，解放小拇指和無名指，同時對其他字根進行優化，負責降重和改善手感，以下按照字根大碼排序。加粗的表示没有音託，斜體表示繁體根：

1. 「水」由`As`改为`Ah`。提升手感，`h`在拼音中，可以分散双手。
2. **「子」由`Bz`改为`Bj`。解放小拇指，选取字母`j`可以分散双手。**
3. 「习」由`Ci`改为`Cx`。把`Ci`让给高频字「小」。
4. 「小」由`Cx`改为`Ci`。解放无名指，`i`在拼音中。
5. 「西」由`Ex`改为`Ei`。解放无名指，`i`在拼音中。
6. **「長」由`Ez`改为`Ej`。解放小拇指。**
7. **「至」由`Fz`改为`Fj`。解放小拇指。**
8. 「面」由`Gm`改为`Ga`。降重。
9. 「耳」由`He`改为`Hr`。降重。
10. **「走」由`Jz`改为`Js`。解放小拇指，选取字母`s`可以分散双手。**
11. 「早」由`Kz`改为`Ka`。解放小拇指。
12. 「止」由`Lz`改为`Li`。解放小拇指。
13. 「黑」由`Mh`改为`Me`，提升手感，降重。
14. 「且」由`Nq`改为`Ne`，提升手感。
15. **「夕」由`Qx`改为`Qk`。解放无名指，选取字母`k`可以分散双手。**
16. 「爪」由`Rz`改为`Ra`。解放小拇指。
17. 「心」由`Rx`改为`Ri`。解放无名指，可以分散双手。
18. 「行」由`Sx`改为`Si`。解放无名指，可以分散双手。
19. 「自」由`Tz`改为`Ti`。解放小拇指。
20. 「乂」由`Ti`改为`Tk`。把碼位讓給「自」。
21. **「匕」由`Vi`改为`Vk`。降重。**

其他的调整有：

1. 增加「咼」字根，码位为`Nu`，同「冎」字根一致。原因是兩字基本不存在對立，還能顯著提高繁體輸入的手感，之前高頻的「過」「回」「問」前兩碼都是`NO`，設置簡碼不方便。

### 4.4. 方案名

本方案同原版方案并列安装，名为`xuma_forfudan_ergo`。

<!-- ### 4.5. 字根圖

本方案字根图如下（调整的字根放在最后）：

![徐碼字根鍵位圖ForFudan調整](/resources/徐碼字根鍵位圖ForFudan調整.jpg) -->

### 4.5. 手感數據

以下为本改动方案的最终按键频率。

注意到，原码表中，`z` 键的使用率竟排在前五（~5%）。调整版中，`z` 键使用率降至最末（~1%）。

#### 4.5.1. 简体文本调整版数据

单字全码派，字母按键频率按照从多到少排序为:
`uviwgskobjefltmdpacyhnqxrz`

左手: 54.94%
下排: 22.66%
中排: 36.03%
上排: 41.31%
左小: 5.95%
左無: 12.59%
左中: 10.20%
左食: 26.19%
右食: 23.13%
右中: 10.82%
右無: 8.18%
右小: 2.93%

字词全码派，字母按键频率按照从多到少排序为:
`wugbiksftlojvepycdxharqnmz`

左手: 57.69%
下排: 21.10%
中排: 36.86%
上排: 42.04%
左小: 6.32%
左無: 14.28%
左中: 10.05%
左食: 27.04%
右食: 20.21%
右中: 9.78%
右無: 8.84%
右小: 3.48%
<!-- 
#### 4.5.2. 简体文本原码表数据

单字全码派，字母按键频率按照从多到少排序为:
`uvgbzdosefitxwjklcymprqhan`

左手: 59.98%
下排: 28.62%
中排: 32.63%
上排: 38.76%
左小: 8.87%
左無: 11.68%
左中: 12.21%
左食: 27.23%
右食: 21.50%
右中: 7.25%
右無: 8.16%
右小: 3.10%

字词全码派，字母按键频率按照从多到少排序为:
`bguzftsovekjwxdlpycirqmhan`

左手: 61.66%
下排: 27.39%
中排: 34.63%
上排: 37.99%
左小: 9.87%
左無: 12.23%
左中: 10.93%
左食: 28.64%
右食: 19.75%
右中: 7.10%
右無: 7.95%
右小: 3.55% -->

#### 4.5.2. 繁体文本调整版数据

单字全码派，字母按键频率按照从多到少排序为:
`uvgisjowklbetfymdahpnqcxrz`

左手: 52.72%
下排: 22.05%
中排: 37.40%
上排: 40.55%
左小: 5.88%
左無: 12.22%
左中: 9.01%
左食: 25.61%
右食: 25.29%
右中: 9.91%
右無: 9.11%
右小: 2.97%

字词全码派，字母按键频率按照从多到少排序为:
`ugsjwliotbvkyfenphadxmrcqz`

左手: 53.51%
下排: 20.46%
中排: 38.63%
上排: 40.91%
左小: 5.87%
左無: 13.29%
左中: 8.52%
左食: 25.82%
右食: 24.48%
右中: 9.11%
右無: 9.68%
右小: 3.22%

<!-- ### 4.6. 更新日志

2023年1月23日

- 根據2023年1月15日版本調整。

2022年12月16日

- 調整恢復部分字根碼位。使得同原徐碼的區别不會太大。
- GB2312 重碼定在320箇。
- 本方案以後不會再多更改。

2022年12月11日

- 調整「文」「甫」「⼻」字根碼位。
- 不改變大碼的情况下，重碼已經降到極致。以後只攷慮大碼的調整。

2022年12月10日

- 更新字根，大幅降低重碼。
- 提供拆分。
- 增加CJK-H區的漢字的編碼。

2022年12月8日：

- 更新「而」「且」「厂」三字根码位分别为`Gj`、`Ne`、`Gh`。
- 恢復「三」爲`Is`，删除「兑」字根。 -->
